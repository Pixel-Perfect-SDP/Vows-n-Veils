<!--
<head>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
-->
<header class="topbar">
  <section class="logo-area">
    <img class="logo-img" src="assets/logo.jpg" alt="Vows & Veils logo" />
    <h1 class="logo-text">Vows & Veils</h1>
  </section>

  <nav class="nav-links">
    <section>

      <button type="button" class="notif-btn" (click)="goToNotifications()" *ngIf="hasVenueCompany">
        <svg xmlns="http://www.w3.org/2000/svg" height="25px" viewBox="0 0 24 24" width="25px" fill="#000000">
          <path
            d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z" />
        </svg>

        <span class="notification-dot" *ngIf="unreadCount > 0">{{ unreadCount }}</span>
      </button>

    </section>
    <a (click)="trackorders()" *ngIf="hasVenueCompany"> Track My Orders</a>
    <a (click)="logout()">Log out</a>


  </nav>
</header>

<section class="manageservices-section">

  <!-- Loading -->
  <section class="loading-container" *ngIf="hasVenueCompany === null">
    <section class="Loading-1"></section>
    <section class="Loading-2"></section>
  </section>

  <section class="loading-overlay" *ngIf="loading">
    <section class="loading-container" *ngIf="hasVenueCompany === null">
      <section class="Loading-1"></section>
      <section class="Loading-2"></section>
    </section>
  </section>


  <!-- If venue company exists -->
  <section class="has-venue-company" *ngIf="hasVenueCompany && companyVenueData">


    <section class="venue-company-details">
      <p class="company-name">Welcome, {{ companyVenueData.companyName }}</p>
    </section>
  </section>

  <!-- Venues area -->
  <section class="services" *ngIf="hasVenueCompany && companyVenueData">
    <h3 class="my-venues">My venues:</h3>
    <section class="button-container">
      <button (click)="select('Venues')" [ngClass]="selected === 'Venues' ? 'yes-style' : 'default-style'">View my
        venues</button>
      <button class="add-venue-btn" *ngIf="selected === 'Venues' && !addingVenue && !editingVenue"
        (click)="AddVenue()">Add Venue</button>
      <button class="map-toggle-btn" *ngIf="selected === 'Venues'" (click)="toggleMap()">
        {{ mapVisible ? 'Hide Map' : 'Show Map' }}
      </button>
    </section> <!--button-container-->

    <!-- Map Section -->
    <section class="map-section" *ngIf="mapVisible && selected === 'Venues'">
      <!-- Map Search Bar -->
      <section class="map-search-bar">
        <input type="text" [(ngModel)]="searchAddress" placeholder="Search for a location..." class="map-search-input"
          (keyup.enter)="searchLocation()" />
        <button (click)="searchLocation()" class="map-search-btn" [disabled]="mapLoading">
          {{ mapLoading ? 'Searching...' : 'Search' }}
        </button>
      </section>

      <!-- Loading -->
      <section class="map-loading" *ngIf="mapLoading">
        <section class="map-loader"></section>
        <span>Loading map data...</span>
      </section>

      <!-- Error -->
      <section class="map-error" *ngIf="mapError && !mapLoading">
        <span>{{ mapError }}</span>
        <section class="map-error-help" *ngIf="mapError.includes('temporarily unavailable')">
          <small>üí° You can still enter addresses manually in the venue form below</small>
        </section>
      </section>

      <!-- Map Display -->
      <section class="map-container" *ngIf="mapVisible && !mapError">
        <section class="map-display">
          <!-- Real Leaflet Map -->
          <section id="leaflet-map" class="leaflet-map-container"></section>

          <!-- Map Info Panel -->
          <section class="map-info-panel">
            <section class="map-info-section" *ngIf="mapPin">
              <h4>üìç Current Location</h4>
              <p class="location-address">{{ mapPin?.address || 'Click on the map to select a location' }}</p>
              <p class="location-coords" *ngIf="mapPin">{{ mapPin.lat | number:'1.4-4' }}, {{ mapPin.lon |
                number:'1.4-4' }}</p>

              <button *ngIf="(addingVenue || editingVenue) && mapPin" (click)="useLocationForVenue()"
                class="use-location-btn">
                Use this address for venue
              </button>
            </section>

            <section class="map-info-section" *ngIf="!mapPin && mapVisible">
              <h4>üó∫Ô∏è Interactive Map</h4>
              <p class="location-address">Click anywhere on the map to select a location</p>
              <small>You can also search for addresses using the search box above</small>
            </section>

            <!-- Nearby Places -->
            <section class="map-info-section" *ngIf="nearbyPlaces.length > 0">
              <h4>üèõÔ∏è Nearby Venues</h4>
              <section class="nearby-places">
                <section class="nearby-place" *ngFor="let venue of nearbyPlaces | slice:0:5">
                  <span class="place-name">{{ venue.name }}</span>
                  <span class="place-type">{{ getVenueTypeLabel(venue.venueType) }}</span>
                  <span class="venue-address" *ngIf="venue.address">{{ venue.address }}</span>
                </section>
              </section>
            </section>
          </section>
        </section>
      </section>
    </section>


    <section class="content" *ngIf="selected === 'Venues'; else noVenues">

      <!-- Add Venue Form -->
      <section *ngIf="addingVenue" class="update-form">
        <h2>Add a new venue</h2>

        <label>Venue Name:</label>
        <input type="text" [(ngModel)]="newVenueData.venuename" placeholder="Add new venue name" />

        <label>Description:</label>
        <input type="text" [(ngModel)]="newVenueData.description" placeholder="Add venue description" />

        <label>Address:</label>
        <input type="text" [(ngModel)]="newVenueData.address" placeholder="Add venue address" />

        <label>Email:</label>
        <input type="email" [(ngModel)]="newVenueData.email" placeholder="Add contact email" />

        <label>Phone Number:</label>
        <input type="text" [(ngModel)]="newVenueData.phonenumber" placeholder="Add contact number" />

        <label>Capacity:</label>
        <input type="number" [(ngModel)]="newVenueData.capacity" placeholder="Add venue capacity" />

        <label>Price:</label>
        <input type="number" [(ngModel)]="newVenueData.price" placeholder="Add venue price" />

        <label>Upload Images (max 6):</label>
        <input type="file" (change)="onFileSelected($event)" multiple accept="image/*" />

        <section class="form-buttons">
          <button (click)="SubmitNewVenue()">Add Venue</button>
          <button (click)="CancelAdd()">Cancel</button>
        </section>
      </section><!--adding venue form-->

      <!-- Venue Cards -->
      <section *ngIf="!addingVenue && !editingVenue" class="venue-list">
        <section class="card" *ngFor="let venue of venues">
          <h3>{{ venue.venuename }}</h3>
          <img *ngIf="venue.images && venue.images[0]?.url" [src]="venue.images[0].url" alt="{{venue.venuename}}" />
          <label class="statuslabel">Status: {{venue.status}}</label>
          <button class="btn" *ngIf="venue.status!== 'rejected'" (click)="UpdateVenue(venue)">Update Venue
            Details</button>
          <button class="btn delete-btn" (click)="DeleteVenue(venue)">Delete Venue</button>


        </section>
      </section>

      <!-- Update Form -->
      <section *ngIf="editingVenue" class="update-form">
        <h2>Update Venue: {{ editingVenue.venuename }}</h2>

        <!-- Venue fields -->
        <label>Venue Name</label>
        <input type="text" [(ngModel)]="updateData.venuename" placeholder="Add new venue name" />

        <label>Description</label>
        <input type="text" [(ngModel)]="updateData.description" placeholder="Add new description" />

        <label>Address</label>
        <input type="text" [(ngModel)]="updateData.address" placeholder="Add new address" />

        <label>Email</label>
        <input type="email" [(ngModel)]="updateData.email" placeholder="Add new email" />

        <label>Phone Number</label>
        <input type="text" [(ngModel)]="updateData.phonenumber" placeholder="Add new phone number" />

        <label>Capacity</label>
        <input type="number" [(ngModel)]="updateData.capacity" placeholder="Add new capacity" />

        <label>Price</label>
        <input type="number" [(ngModel)]="updateData.price" placeholder="Add new price" />

        <!-- Existing images -->
        <section class="image-list" *ngIf="editingVenue.images?.length > 0">
          <section class="image-item" *ngFor="let img of editingVenue.images; let i = index">
            <img *ngIf="img?.url" [src]="img.url" alt="Venue Image"
              style="max-width: 150px; max-height: 150px; object-fit: cover; border-radius: 8px;" />
            <label *ngIf="img">
              <input type="checkbox" [(ngModel)]="updateData.imagesToDelete[i]" />
              Delete
            </label>

            <p class="disclaimer" *ngIf="img">
              Deleted images cannot be retrieved once the update button is pressed.
            </p>
          </section>
        </section>



        <!-- Add new images -->
        <label>Upload New Images (optional)</label>
        <input type="file" (change)="onNewFilesSelected($event)" multiple accept="image/*" />

        <!-- Form buttons -->
        <section class="form-buttons">
          <button (click)="SubmitUpdate()">Update</button>
          <button (click)="CancelUpdate()">Cancel</button>
        </section>
      </section>


    </section>

    <ng-template #noVenues>
      <p>NEED TO PUT VENDOR INFOMATIONS</p>
    </ng-template>

  </section>



  <!-- If no vendor company -->
  <section class="create-venue-company" *ngIf="hasVenueCompany === false">
    <section class="venue-company-card">
      <img src="assets/logo.jpg" alt="Vows & Veils logo" class="logo" />
      <h2>Join as a venue company</h2>
      <p>Fill in the details to get started!</p>
    </section>

    <section class="venue-company-form">
      <form [formGroup]="form" (ngSubmit)="createVenueCompany()">
        <label>Company Name:</label>
        <input formControlName="companyName" />

        <label>Contact Email:</label>
        <input type="email" formControlName="companyEmail" />

        <label>Phone Number:</label>
        <input formControlName="companyNumber" />

        <button type="submit" [disabled]="form.invalid">Create venue account</button>
      </form>
    </section>
  </section>

</section>
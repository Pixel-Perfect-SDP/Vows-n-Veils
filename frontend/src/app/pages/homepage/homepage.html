<header class="topbar">
  <section class="logo-area">
    <img class="logo-img" src="assets/logo.jpg" alt="Vows & Veils logo" />
    <h1 class="logo-text">Vows & Veils</h1>
  </section>

  <nav class="nav-links">
    <section>

      <button type="button" class="notif-btn" (click)="goToNotifications()" *ngIf="hasEvent=== true">
        <svg xmlns="http://www.w3.org/2000/svg" height="25px" viewBox="0 0 24 24" width="25px" fill="#000000">
          <path
            d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z" />
        </svg>

        <span class="notification-dot" *ngIf="unreadCount > 0">{{ unreadCount }}</span>
      </button>

    </section>
    <a routerLink="/landing" *ngIf="hasEvent === false">Back</a>
    <a (click)="logout()" *ngIf="hasEvent === true">Log out</a>
  </nav>
</header>
<!-- if user does NOT have an event: -->
<!-- show create event page -->
<section class="create-event" *ngIf="hasEvent === false">

  <h2 class="plan-wedd">Plan your wedding</h2>
  <p class="plan-weddp">Fill in the details below to get started!</p>

  <section class="event-form">
    <form [formGroup]="form" (ngSubmit)="createEvent()">
      <label>Name of first partner:</label>
      <input formControlName="name1" />

      <label>Name of second partner:</label>
      <input formControlName="name2" />

      <label>Date of wedding:</label>
      <input type="date" formControlName="date" />

      <label>Time of wedding:</label>
      <input type="time" formControlName="time" />

      <label>Budget: </label>
      <input type="number" formControlName="budget" placeholder="ZAR" />

      <button type="submit" [disabled]="form.invalid">Create our wedding</button>
    </form>
  </section>
</section>

<section class="loading-container" *ngIf="hasEvent === null">
  <section class="Loading-1"></section>
  <section class="Loading-2"></section>
</section>

<section class="homepage-section" *ngIf="hasEvent === true">



  <!-- If user DOES have an event -->
  <section class="has-event" *ngIf="hasEvent && eventData">
    <input id="sb-toggle" type="checkbox" class="sb-toggle" aria-label="Toggle sidebar" />

    <!-- Sidebar -->
    <nav class="sidebar">
      <ul>
        <li><a routerLink="/story" routerLinkActive="active">Our Story</a></li>
        <li>
          <a href="#" [class.active]="activeTab==='guests'" (click)="switchToGuests($event)">Guest List</a>
        </li>
        <li><a routerLink="/invitations" routerLinkActive="active">Invitations</a></li>
        <li><a routerLink="/venues" routerLinkActive="active">Venues</a></li>
        <li><a routerLink="/vendors-couples" routerLinkActive="active">Vendors</a></li>
      </ul>
    </nav>

    <!-- Main content column -->
    <section class="main">
      <header class="event-header">
        <label for="sb-toggle" class="hamburger" title="Toggle sidebar" aria-label="Toggle sidebar">
          &#9776;
        </label>

        <section class="event-hero">
          <p class="names">Welcome, {{ eventData.Name1 }} and {{ eventData.Name2 }}</p>
        </section>
      </header>

      <!-- Weather Bar -->
      <section class="weather-bar" *ngIf="eventData?.VenueID">
        <!-- Loading -->
        <ng-container *ngIf="weatherLoading">
          <section class="wb-row">
            <section class="wb-icon-skel"></section>
            <section class="wb-text-skel"></section>
            <section class="wb-text-skel short"></section>
          </section>
        </ng-container>

        <!-- Error -->
        <ng-container *ngIf="weatherError && !weatherLoading">
          <section class="wb-row wb-error">
            <span>{{ weatherError }}</span>
          </section>
        </ng-container>

        <ng-container *ngIf="weather && !weatherLoading && !weatherError">
          <section class="wb-row">
            <section class="wb-icon" [ngClass]="getWeatherIconClass(weather.days[0])" aria-hidden="true"></section>

            <section class="wb-col">
              <section class="wb-title">Wedding Weather</section>
              <section class="wb-sub">
                <strong>{{ weather.resolvedAddress || weather.address }}</strong>
                ‚Ä¢ {{ weather.days[0].datetime }}
                <ng-container *ngIf="weather.days[0].description">
                  ‚Ä¢ {{ weather.days[0].description }}
                </ng-container>
                <ng-container *ngIf="!weather.days[0].description">
                  ‚Ä¢ {{ getConditionLabel(weather.days[0]) }}
                </ng-container>
              </section>
            </section>

            <section class="wb-metrics">
              <section class="wb-chip">
                üå°Ô∏è {{ (((weather.days[0].temp - 32) * 5) / 9) | number:'1.0-0' }}¬∞C
              </section>
              <section class="wb-chip" *ngIf="weather.days[0].humidity !== undefined">
                üíß {{ weather.days[0].humidity }}%
              </section>
              <section class="wb-chip" *ngIf="getPrecipPercent(weather.days[0]) !== null">
                ‚òî {{ getPrecipPercent(weather.days[0]) }}%
              </section>
            </section>
          </section>
        </ng-container>
      </section>

      <!-- If no venue yet -->
      <section class="weather-bar wb-empty" *ngIf="!eventData?.VenueID">
        <section class="wb-row">
          <section class="wb-icon" aria-hidden="true">‚õÖ</section>
          <section class="wb-col">
            <section class="wb-title">Add a venue to see your wedding weather</section>
            <section class="wb-sub">We‚Äôll pull the forecast for your exact location & date.</section>
          </section>
        </section>
      </section>



      <section class="countdown-section">
        <h2 class=countHead>Time until we tie the knot.....</h2>
        <!-- Countdown -->
        <section class="countdown">
          <span class="countBox">
            <h2 class="months"> {{months | number: '2.0'}}</h2>
            <hr class="divider">
            <p>Months</p>
          </span>

          <span class="countBox">
            <h2 class="days"> {{days | number: '2.0'}}</h2>
            <hr class="divider">
            <p>Days</p>
          </span>

          <span class="countBox">
            <h2 class=" hours"> {{hours | number: '2.0'}}</h2>
            <hr class="divider">
            <p>Hours</p>
          </span>

          <span class="countBox">
            <h2 class="minutes"> {{minutes | number: '2.0'}}</h2>
            <hr class="divider">
            <p>Minutes</p>
          </span>

        </section>
      </section>

      <!-- Event Information Panel -->
      <section class="event-info-panel" *ngIf="hasEvent && eventData">
        <!-- Loading State -->
        <section class="event-info-loading" *ngIf="eventInfoLoading">
          <section class="loading-spinner"></section>
          <p>Loading event details...</p>
        </section>

        <!-- Error State -->
        <section class="event-info-error" *ngIf="eventInfoError && !eventInfoLoading">
          <p class="error-message">{{ eventInfoError }}</p>
        </section>

        <!-- Event Data Display -->
        <section class="event-info-content" *ngIf="!eventInfoLoading && !eventInfoError">
          <section class="event-info-grid">

            <!-- Wedding Title -->
            <section class="info-card wedding-title" *ngIf="eventDisplayInfo.weddingTitle">
              <h2 class="card-title">{{ eventDisplayInfo.weddingTitle }}</h2>
            </section>

            <!-- Venue Information -->
            <section class="info-card venue-info" *ngIf="eventDisplayInfo.venueName">
              <section class="card-header">
                <span class="card-icon">üìç</span>
                <h3>Venue</h3>
              </section>
              <p class="card-value">{{ eventDisplayInfo.venueName }}</p>
            </section>

            <!-- Wedding Time -->
            <section class="info-card time-info" *ngIf="eventDisplayInfo.weddingTime">
              <section class="card-header">
                <span class="card-icon">‚è∞</span>
                <h3>Time of Wedding</h3>
              </section>
              <p class="card-value">{{ eventDisplayInfo.weddingTime }}</p>
            </section>

            <!-- Budget -->
            <section class="info-card budget-info" *ngIf="eventDisplayInfo.budget">
              <section class="card-header">
                <span class="card-icon">üí∞</span>
                <h3>Budget</h3>
              </section>
              <p class="card-value">R{{ eventDisplayInfo.budget | number:'1.2-2' }}</p>
            </section>

            <!-- Total Guests -->
            <section class="info-card guests-info" *ngIf="eventDisplayInfo.totalGuests !== null">
              <section class="card-header">
                <span class="card-icon">üë•</span>
                <h3>Total Guests</h3>
              </section>
              <p class="card-value">{{ eventDisplayInfo.totalGuests }}</p>
            </section>

            <!-- Confirmed RSVPs -->
            <section class="info-card rsvp-info" *ngIf="eventDisplayInfo.confirmedRSVPs !== null">
              <section class="card-header">
                <span class="card-icon">‚úÖ</span>
                <h3>Confirmed RSVPs</h3>
              </section>
              <p class="card-value">{{ eventDisplayInfo.confirmedRSVPs }}</p>
              <p class="card-subtitle" *ngIf="eventDisplayInfo.totalGuests">
                ({{ (eventDisplayInfo.confirmedRSVPs / eventDisplayInfo.totalGuests * 100) | number:'1.0-0' }}% response
                rate)
              </p>
            </section>

            <!--  RSVP code -->
            <section class="info-card">
              <section class="card-header">
                <section class="card-icon">üîó</section>
                <h3>Wedding Code</h3>
              </section>
              <section class="code-row">
                <p class="card-value">{{ eventDisplayInfo.rsvpCode || 'No code available' }} </p>
                <button class="copy-btn" (click)="copyToClipboard(eventDisplayInfo.rsvpCode || '')">
                  üìã<p>copy</p>
                </button>

              </section>

              <p class="card-subtitle">Share this code with guests in order to RSVP.</p>
            </section>

            <!-- Selected Vendors -->
            <section class="info-card vendors-info"
              *ngIf="eventDisplayInfo.selectedVendors && eventDisplayInfo.selectedVendors.length > 0">
              <section class="card-header">
                <span class="card-icon">üè™</span>
                <h3>Selected Vendors</h3>
              </section>
              <section class="vendors-list">
                <section class="vendor-item" *ngFor="let vendor of eventDisplayInfo.selectedVendors">
                  <section class="vendor-name">{{ vendor.serviceName }}</section>
                  <section class="vendor-date" *ngIf="vendor.orderDate">
                    Ordered: {{ vendor.orderDate | date:'MMM d, y' }}
                  </section>
                </section>
              </section>
              <p class="card-subtitle">{{ eventDisplayInfo.selectedVendors.length }} vendor(s) selected</p>
            </section>

          </section>
        </section>
      </section>



      <!-- Default landing content -->
      <section class="content" *ngIf="activeTab==='overview'">
        <!-- your overview content -->
      </section>

      <!---------Guest list panel----------->
      <section class="content" *ngIf="activeTab==='guests'">
        <h2 class="sr-only">Guest List</h2>

        <!-- your filters row stays above -->
        <section class="filters-row">
          <section class="filter-group">
            <section class="filter">
              <label>Dietary</label>
              <select [(ngModel)]="selectedDietary" (change)="onFiltersChange()">
                <option [ngValue]="null">All</option>
                <option *ngFor="let d of dietaryOptions" [value]="d">{{ d }}</option>
              </select>
            </section>

            <section class="filter">
              <label>Allergies</label>
              <select [(ngModel)]="selectedAllergy" (change)="onFiltersChange()">
                <option [ngValue]="null">All</option>
                <option *ngFor="let a of allergyOptions" [value]="a">{{ a }}</option>
              </select>
            </section>

            <section class="filter">
              <label>RSVP</label>
              <select [(ngModel)]="selectedRsvp" (change)="onFiltersChange()">
                <option value="all">All</option>
                <option value="true">Attending</option>
                <option value="false">Not Attending</option>
              </select>
            </section>

          </section>

          <section class="addGuest">
            <button type="button" class="btn" (click)="toggleAddGuest()">
              {{ showAddGuest ? 'Close' : 'Add Guest' }}
            </button>

            <button type="button" class="btn" (click)="toggleExport()">
              {{ showExport ? 'Close' : 'Export' }}
            </button>
          </section>
        </section>

        <!-- Actions row -->

        <!-- Add Guest Card -->
        <section class="add-card" *ngIf="showAddGuest">
          <form [formGroup]="addGuestForm" (ngSubmit)="submitAddGuest()">
            <section class="form-grid">
              <label>
                <span>Name *</span>
                <input formControlName="Name" placeholder="Full name" />
              </label>

              <label>
                <span>Email</span>
                <input formControlName="Email" type="email" placeholder="email@example.com" />
              </label>

              <label>
                <span>Dietary</span>
                <input formControlName="Dietary" placeholder="e.g. Vegan" />
              </label>

              <label>
                <span>Allergies</span>
                <input formControlName="Allergies" placeholder="e.g. Peanuts" />
              </label>

              <label>
                <span>RSVP</span>
                <select formControlName="RSVPstatus">
                  <option value="true">Attending</option>
                  <option value="false">Not Attending</option>
                </select>
              </label>

              <label class="grid-span-2">
                <span>Song request</span>
                <input formControlName="Song" placeholder="Favorite song" />
              </label>
            </section>

            <section class="add-card-actions">
              <button type="button" class="btn btn-secondary" (click)="toggleAddGuest()">Cancel</button>
              <button type="submit" class="btn btn-primary" [disabled]="addGuestForm.invalid || guestsLoading">
                Save Guest
              </button>
            </section>
          </form>
        </section>

        <!-- Add download options -->
        <section class="add-card" *ngIf="showExport">
          <section style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
            <strong>Export Guest List</strong>
            <small style="color:#666;">Applies current filters</small>
          </section>

          <section style="display:flex; gap:10px; flex-wrap:wrap;">
            <button type="button" class="btn btn-primary" (click)="exportCsv()">
              Download CSV
            </button>
            <button type="button" class="btn btn-primary" (click)="exportPdf()">
              Download PDF
            </button>
          </section>
        </section>


        <!-- Card -->
        <section class="table-card">
          <section class="table-header">
            <section class="table-title">Guests</section>
            <!-- space for future actions (export, add guest, etc.) -->
            <section></section>
          </section>

          <!-- Loading -->
          <section *ngIf="guestsLoading" class="table-container">
            <table class="guest-table" aria-busy="true" aria-live="polite">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Dietary</th>
                  <th>Allergies</th>
                  <th>RSVP</th>
                  <th>Song</th>
                </tr>
              </thead>
              <tbody>
                <tr class="loading-row" *ngFor="let s of [1,2,3,4,5]">
                  <td colspan="6"></td>
                </tr>
              </tbody>
            </table>
          </section>

          <!-- Error -->
          <section *ngIf="guestsError && !guestsLoading" class="empty-state">
            {{ guestsError }}
          </section>

          <!-- Table -->
          <section *ngIf="!guestsLoading && !guestsError" class="table-container">
            <table *ngIf="guests?.length; else emptyGuests" class="guest-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Dietary</th>
                  <th>Allergies</th>
                  <th>RSVP</th>
                  <th>Song</th>
                  <th style="width:1%; white-space: nowrap;">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let g of guests">
                  <td>{{ g.Name }}</td>
                  <td class="td-clip" title="{{ g.Email }}">{{ g.Email }}</td>
                  <td>
                    <span class="tag" *ngIf="g.Dietary; else noDiet">{{ g.Dietary }}</span>
                    <ng-template #noDiet><span class="chip chip--muted">None</span></ng-template>
                  </td>
                  <td>
                    <span class="tag" *ngIf="g.Allergies; else noAllergy">{{ g.Allergies }}</span>
                    <ng-template #noAllergy><span class="chip chip--muted">None</span></ng-template>
                  </td>
                  <td>
                    <span class="chip" [ngClass]="g.RSVPstatus ? 'chip--ok' : 'chip--no'">
                      {{ g.RSVPstatus ? 'Attending' : 'Not Attending' }}
                    </span>
                  </td>
                  <td class="td-clip" title="{{ g.Song }}">{{ g.Song }}</td>
                  <td>
                    <button type="button" class="icon-btn success" title="Send invitation"
                      aria-label="Send invitation to {{ g.Name }}" (click)="sendInvitation(g)"
                      [disabled]="guestsLoading || !g.Email" style="margin-right: 8px;">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        viewBox="0 0 16 16">
                        <path
                          d="M.05 3.555A2 2 0 0 1 2 2h12a2 2 0 0 1 1.95 1.555L8 8.414.05 3.555ZM0 4.697v7.104l5.803-3.558L0 4.697ZM6.761 8.83l-6.57 4.027A2 2 0 0 0 2 14h12a2 2 0 0 0 1.808-1.144l-6.57-4.027L8 9.586l-1.239-.757Zm3.436-.586L16 11.801V4.697l-5.803 3.546Z" />
                      </svg>
                    </button>
                    <button type="button" class="icon-btn danger" title="Delete guest" aria-label="Delete guest"
                      (click)="onDeleteGuest(g)" [disabled]="guestsLoading">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        viewBox="0 0 16 16">
                        <path
                          d="M5.5 5.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0V6H7v6.5a.5.5 0 0 1-1 0v-7z" />
                        <path fill-rule="evenodd"
                          d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4H2.5a1 1 0 0 1 0-2h3.086a1 1 0 0 1 .707-.293h2.414a1 1 0 0 1 .707.293H13.5a1 1 0 0 1 1 1zM4.118 4l.39 9.447A1 1 0 0 0 5.5 14.5h5a1 1 0 0 0 .992-.947L11.882 4H4.118z" />
                      </svg>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>

            <ng-template #emptyGuests>
              <section class="empty-state">No guests match the selected filters.</section>
            </ng-template>
          </section>
        </section>
      </section>


    </section><!-- /.main -->
  </section><!-- /.has-event -->
</section>
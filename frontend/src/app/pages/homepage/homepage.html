<section class="homepage-section">

  <section class="loading-container" *ngIf="hasEvent === null">
    <section class="Loading-1"></section>
    <section class="Loading-2"></section>
  </section>

  <!-- If user DOES have an event -->
  <section class="has-event" *ngIf="hasEvent && eventData">

    <!-- CSS-ONLY SIDEBAR TOGGLE (no TS needed) -->
    <input id="sb-toggle" type="checkbox" class="sb-toggle" aria-label="Toggle sidebar" />

    <!-- Sidebar -->
    <nav class="sidebar">
      <section class="sidebar-header">
        <img src="assets/logo.jpg" alt="Vows & Veils logo" class="logo" />
        <h1>Vows & Veils</h1>
      </section>
      <ul>
        <li>
          <a href="#" [class.active]="activeTab==='guests'" (click)="switchToGuests($event)">Guest List</a>
        </li>
        <li><a routerLink="/invitations" routerLinkActive="active">Invitations</a></li>
        <li><a routerLink="/venues" routerLinkActive="active">Venues</a></li>
        <li><a routerLink="/vendors-couples" routerLinkActive="active">Vendors</a></li>
        <li class="LogOut"><a (click)="logout()">Log out</a></li>
      </ul>
    </nav>

    <!-- Main content column -->
    <div class="main">
      <!-- Header / event banner lives INSIDE the flow (no overlap) -->
      <header class="event-header">
        <!-- Hamburger -->
        <label for="sb-toggle" class="hamburger" title="Toggle sidebar" aria-label="Toggle sidebar">
          &#9776;
        </label>

        <div class="event-hero">
          <p class="names">Welcome, {{ eventData.Name1 }} and {{ eventData.Name2 }}</p>
        </div>
      </header>

      <!-- Weather Bar (full-width, under header) -->
      <section class="weather-bar" *ngIf="eventData?.VenueID">
        <!-- Loading -->
        <ng-container *ngIf="weatherLoading">
          <div class="wb-row">
            <div class="wb-icon-skel"></div>
            <div class="wb-text-skel"></div>
            <div class="wb-text-skel short"></div>
          </div>
        </ng-container>

        <!-- Error -->
        <ng-container *ngIf="weatherError && !weatherLoading">
          <div class="wb-row wb-error">
            <span>{{ weatherError }}</span>
          </div>
        </ng-container>

        <!-- Data -->
        <!-- Data -->
        <ng-container *ngIf="weather && !weatherLoading && !weatherError">
          <div class="wb-row">
            <!-- ICON (auto picks class based on conditions/probability) -->
            <div class="wb-icon" [ngClass]="getWeatherIconClass(weather.days[0])" aria-hidden="true"></div>

            <div class="wb-col">
              <div class="wb-title">Wedding Weather</div>
              <div class="wb-sub">
                <strong>{{ weather.resolvedAddress || weather.address }}</strong>
                ‚Ä¢ {{ weather.days[0].datetime }}
                <ng-container *ngIf="weather.days[0].description">
                  ‚Ä¢ {{ weather.days[0].description }}
                </ng-container>
                <ng-container *ngIf="!weather.days[0].description">
                  ‚Ä¢ {{ getConditionLabel(weather.days[0]) }}
                </ng-container>
              </div>
            </div>

            <div class="wb-metrics">
              <div class="wb-chip">
                üå°Ô∏è {{ (((weather.days[0].temp - 32) * 5) / 9) | number:'1.0-0' }}¬∞C
              </div>
              <div class="wb-chip" *ngIf="weather.days[0].humidity !== undefined">
                üíß {{ weather.days[0].humidity }}%
              </div>
              <div class="wb-chip" *ngIf="getPrecipPercent(weather.days[0]) !== null">
                ‚òî {{ getPrecipPercent(weather.days[0]) }}%
              </div>
            </div>
          </div>
        </ng-container>
      </section>

      <!-- If no venue yet -->
      <section class="weather-bar wb-empty" *ngIf="!eventData?.VenueID">
        <div class="wb-row">
          <div class="wb-icon" aria-hidden="true">‚õÖ</div>
          <div class="wb-col">
            <div class="wb-title">Add a venue to see your wedding weather</div>
            <div class="wb-sub">We‚Äôll pull the forecast for your exact location & date.</div>
          </div>
        </div>
      </section>


      <body>
        <h2 class=countHead>Time until we tie the knot.....</h2>
      <!-- Countdown -->
      <section class="countdown">
        <span class="countBox">
          <h2 class="months"> {{months | number: '2.0'}}</h2>
          <hr class="divider">
          <p>Months</p>
        </span>

        <span class="countBox">
          <h2 class="days"> {{days | number: '2.0'}}</h2>
          <hr class="divider">
          <p>Days</p>
        </span>

        <span class="countBox">
          <h2 class=" hours"> {{hours | number: '2.0'}}</h2>
          <hr class="divider">
          <p>Hours</p>
        </span>

        <span class="countBox">
          <h2 class="minutes"> {{minutes | number: '2.0'}}</h2>
          <hr class="divider">
          <p>Minutes</p>
        </span>

      </section>
    </body>

    

      <!-- Default landing content -->
      <section class="content" *ngIf="activeTab==='overview'">
        <!-- your overview content -->
      </section>

      <!---------Guest list panel----------->
      <section class="content" *ngIf="activeTab==='guests'">
        <h2 class="sr-only">Guest List</h2>

        <!-- your filters row stays above -->
        <div class="filters-row">
          <div class = "filter-group">
            <div class="filter">
              <label>Dietary</label>
              <select [(ngModel)]="selectedDietary" (change)="onFiltersChange()">
                <option [ngValue]="null">All</option>
                <option *ngFor="let d of dietaryOptions" [value]="d">{{ d }}</option>
              </select>
            </div>

            <div class="filter">
              <label>Allergies</label>
              <select [(ngModel)]="selectedAllergy" (change)="onFiltersChange()">
                <option [ngValue]="null">All</option>
                <option *ngFor="let a of allergyOptions" [value]="a">{{ a }}</option>
              </select>
            </div>

            <div class="filter">
              <label>RSVP</label>
              <select [(ngModel)]="selectedRsvp" (change)="onFiltersChange()">
                <option value="all">All</option>
                <option value="true">Attending</option>
                <option value="false">Not Attending</option>
              </select>
            </div>

          </div>

          <div class="addGuest">
            <button type="button" class="btn" (click)="toggleAddGuest()">
              {{ showAddGuest ? 'Close' : 'Add Guest' }}
            </button>
            
            <button type="button" class="btn" (click)="toggleExport()">
            {{ showExport ? 'Close' : 'Export' }}
            </button>
          </div>
        </div>

        <!-- Actions row -->

        <!-- Add Guest Card -->
        <div class="add-card" *ngIf="showAddGuest">
          <form [formGroup]="addGuestForm" (ngSubmit)="submitAddGuest()">
            <div class="form-grid">
              <label>
                <span>Name *</span>
                <input formControlName="Name" placeholder="Full name" />
              </label>

              <label>
                <span>Email</span>
                <input formControlName="Email" type="email" placeholder="email@example.com" />
              </label>

              <label>
                <span>Dietary</span>
                <input formControlName="Dietary" placeholder="e.g. Vegan" />
              </label>

              <label>
                <span>Allergies</span>
                <input formControlName="Allergies" placeholder="e.g. Peanuts" />
              </label>

              <label>
                <span>RSVP</span>
                <select formControlName="RSVPstatus">
                  <option value="true">Attending</option>
                  <option value="false">Not Attending</option>
                </select>
              </label>

              <label class="grid-span-2">
                <span>Song request</span>
                <input formControlName="Song" placeholder="Favorite song" />
              </label>
            </div>

            <div class="add-card-actions">
              <button type="button" class="btn btn-secondary" (click)="toggleAddGuest()">Cancel</button>
              <button type="submit" class="btn btn-primary" [disabled]="addGuestForm.invalid || guestsLoading">
                Save Guest
              </button>
            </div>
          </form>
        </div>

        <!-- Add download options -->
        <div class="add-card" *ngIf="showExport">
          <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
            <strong>Export Guest List</strong>
            <small style="color:#666;">Applies current filters</small>
          </div>

          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button type="button" class="btn btn-primary" (click)="exportCsv()">
              Download CSV
            </button>
            <button type="button" class="btn btn-primary" (click)="exportPdf()">
              Download PDF
            </button>
          </div>
        </div>


        <!-- Card -->
        <div class="table-card">
          <div class="table-header">
            <div class="table-title">Guests</div>
            <!-- space for future actions (export, add guest, etc.) -->
            <div></div>
          </div>

          <!-- Loading -->
          <div *ngIf="guestsLoading" class="table-container">
            <table class="guest-table" aria-busy="true" aria-live="polite">
              <thead>
                <tr>
                  <th>Name</th><th>Email</th><th>Dietary</th><th>Allergies</th><th>RSVP</th><th>Song</th>
                </tr>
              </thead>
              <tbody>
                <tr class="loading-row" *ngFor="let s of [1,2,3,4,5]"><td colspan="6"></td></tr>
              </tbody>
            </table>
          </div>

          <!-- Error -->
          <div *ngIf="guestsError && !guestsLoading" class="empty-state">
            {{ guestsError }}
          </div>

          <!-- Table -->
          <div *ngIf="!guestsLoading && !guestsError" class="table-container">
            <table *ngIf="guests?.length; else emptyGuests" class="guest-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Dietary</th>
                  <th>Allergies</th>
                  <th>RSVP</th>
                  <th>Song</th>
                  <th style="width:1%; white-space: nowrap;">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let g of guests">
                  <td>{{ g.Name }}</td>
                  <td class="td-clip" title="{{ g.Email }}">{{ g.Email }}</td>
                  <td>
                    <span class="tag" *ngIf="g.Dietary; else noDiet">{{ g.Dietary }}</span>
                    <ng-template #noDiet><span class="chip chip--muted">None</span></ng-template>
                  </td>
                  <td>
                    <span class="tag" *ngIf="g.Allergies; else noAllergy">{{ g.Allergies }}</span>
                    <ng-template #noAllergy><span class="chip chip--muted">None</span></ng-template>
                  </td>
                  <td>
                    <span class="chip" [ngClass]="g.RSVPstatus ? 'chip--ok' : 'chip--no'">
                      {{ g.RSVPstatus ? 'Attending' : 'Not Attending' }}
                    </span>
                  </td>
                  <td class="td-clip" title="{{ g.Song }}">{{ g.Song }}</td>
                  <td>
                    <button
                      type="button"
                      class="icon-btn danger"
                      title="Delete guest"
                      aria-label="Delete guest"
                      (click)="onDeleteGuest(g)"
                      [disabled]="guestsLoading">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M5.5 5.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0V6H7v6.5a.5.5 0 0 1-1 0v-7z"/>
                        <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4H2.5a1 1 0 0 1 0-2h3.086a1 1 0 0 1 .707-.293h2.414a1 1 0 0 1 .707.293H13.5a1 1 0 0 1 1 1zM4.118 4l.39 9.447A1 1 0 0 0 5.5 14.5h5a1 1 0 0 0 .992-.947L11.882 4H4.118z"/>
                      </svg>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>

            <ng-template #emptyGuests>
              <div class="empty-state">No guests match the selected filters.</div>
            </ng-template>
          </div>
        </div>
      </section>


    </div><!-- /.main -->
  </section><!-- /.has-event -->
</section>



<!-- if user doesnt have an event: -->
 <!-- show create event page -->
<section class="create-event" *ngIf="hasEvent === false">
  <section class="event-card">
  <img src="assets/logo.jpg" alt="Vows & Veils logo" class="logo" />
  <h2>Plan your wedding</h2>
  <p>Fill in the details below to get started!</p>
  </section>

<section class="event-form">
  <form [formGroup]="form" (ngSubmit)="createEvent()">
    <label>Name of first partner:</label>
    <input formControlName="name1" />

    <label>Name of second partner:</label>
    <input formControlName="name2" />

    <label>Date of wedding:</label>
    <input type="date" formControlName="date" />

    <label>Time of wedding:</label>
    <input type="time" formControlName="time" />

    <button type="submit" [disabled]="form.invalid">Create our wedding</button>
  </form>
</section>
</section>

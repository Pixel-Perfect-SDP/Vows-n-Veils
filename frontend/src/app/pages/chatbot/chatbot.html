<!-- Floating Chat Button -->
<button class="chat-button" *ngIf="!isOpen" (click)="toggleChat()" aria-label="Open chat">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
    stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
  </svg>
</button>

<!-- Chat Window -->
<aside class="chat-container" *ngIf="isOpen" [class.minimized]="isMinimized">
  <!-- Chat Header -->
  <header class="chat-header">
    <section class="chat-header-content">
      <figure class="chat-avatar">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2">
          <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
        </svg>
      </figure>
      <section class="chat-title">
        <h3>Support Assistant</h3>
        <span class="chat-status">Online</span>
      </section>
    </section>
    <nav class="chat-actions">
      <button (click)="minimizeChat()" class="icon-button" aria-label="Minimize">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2">
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
      </button>
      <button (click)="closeChat()" class="icon-button" aria-label="Close">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </nav>
  </header>

  <!-- Chat Body -->
  <main class="chat-body" *ngIf="!isMinimized">
    <!-- FAQ Quick Buttons -->
    <section class="faq-section" *ngIf="messages.length <= 1">
      <p class="faq-title">Frequently Asked Questions:</p>
      <p class="faq-title">Click on a question below or type your own.</p>
      <nav class="faq-buttons">
        <button *ngFor="let faq of faqs.slice(0,8)" class="faq-button" (click)="selectFAQ(faq)">
          {{ faq.question }}
        </button>
      </nav>
    </section>

    <!-- Messages -->
    <section class="messages">
      <button *ngIf="messages.length > 1" class="back-to-faq-button" (click)="backtofaq()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2">
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
        Back to Questions
      </button>

      <article *ngFor="let message of messages" class="message" [class.user-message]="message.isUser"
        [class.bot-message]="!message.isUser">
        <section class="message-content">
          <p>{{ message.text }}</p>
          <time class="message-time">{{ message.timestamp | date:'shortTime' }}</time>
        </section>
      </article>

      <!-- Loading Indicator -->
      <article *ngIf="isLoading" class="message bot-message">
        <section class="message-content">
          <span class="typing-indicator">
            <span></span>
            <span></span>
            <span></span>
          </span>
        </section>
      </article>
    </section>
  </main>

  <!-- Chat Footer -->
  <footer class="chat-footer" *ngIf="!isMinimized">
    <form class="input-container" (submit)="$event.preventDefault(); sendMessage()">
      <input type="text" [(ngModel)]="userInput" name="userInput" (keypress)="onKeyPress($event)" 
        placeholder="Type your message..." class="chat-input" [disabled]="isLoading">
      <button type="submit" (click)="sendMessage()" class="send-button" [disabled]="!userInput.trim() || isLoading">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2">
          <line x1="22" y1="2" x2="11" y2="13"></line>
          <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
        </svg>
      </button>
    </form>
  </footer>
</aside>